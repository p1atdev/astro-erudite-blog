---
import { Card } from "@/components/ui/card";
import { SITE } from "@/consts";
import type { License } from "@/lib/data-utils";
import { Icon } from "astro-icon/components";

interface Props {
  license?: License;
}

const { license: { type, version } = SITE.defaultLicense } = Astro.props;

const typeIconMap: Record<License["type"], string> = {
  zero: "ri:creative-commons-zero-line",
  by: "ri:creative-commons-by-line",
  sa: "ri:creative-commons-sa-line",
  nc: "ri:creative-commons-nc-line",
  nd: "ri:creative-commons-nd-line",
};

const licenseToUrl = (type: License["type"], version?: string) => {
  const baseUrl = "https://creativecommons.org/licenses";
  const url = (() => {
    if (type === "zero") {
      // https://creativecommons.org/publicdomain/zero/1.0/deed.ja
      return "https://creativecommons.org/publicdomain/zero/1.0/";
    } else {
      return `${baseUrl}/${type}/${version ?? "4.0"}/`;
    }
  })();
  return url + "deed." + SITE.locale.split("-")[0];
};

const typTextMap: Record<License["type"], string> = {
  zero: "CC0 1.0",
  by: `CC BY ${version}`,
  sa: `CC BY-SA ${version}`,
  nc: `CC BY-NC ${version}`,
  nd: `CC BY-ND ${version}`,
};

const url = licenseToUrl(type, version);
---

<Card className="shadow-non4">
  <div class="relative flex items-center justify-between gap-4 overflow-hidden">
    <div class="flex grow flex-col gap-y-0.5 py-2 pl-8">
      <span class="text-primary/50 text-xs">License under</span>
      <span class="text-lg font-medium">
        {typTextMap[type]}
      </span>
      <a href={url} class="text-sm" target="_blank">{url}</a>
    </div>
    <Icon
      name={typeIconMap[type]}
      class="absolute right-4 size-32 opacity-50"
    />
  </div>
</Card>
